<!doctype html><html lang='en'><head>
<meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<title>Flocking (Boids)</title><link rel='stylesheet' href='../../assets/css/style.css'></head><body>
<header class='nav'><div class='container'><a class='brand' href='../../index.html'>&larr; Back</a><button id='theme' class='btn'>Theme</button></div></header>
<section class='container prose'>
  <h2>Flocking (Boids)</h2>
  <p><strong>What you see:</strong> a swarm of “birds” leaving soft motion trails, avoiding obstacles, and steering towards the mouse.</p>
  <p><strong>How to use:</strong> set boid count and the three rules (Separation/Alignment/Cohesion); click Add obstacle; move the mouse to attract the flock.</p>
  
<div class="controls">
  <label>Boids <input id="n" type="range" min="30" max="400" value="150"></label>
  <label>Sep <input id="sep" type="range" min="0" max="2" step="0.05" value="1.0"></label>
  <label>Align <input id="ali" type="range" min="0" max="2" step="0.05" value="0.8"></label>
  <label>Coh <input id="coh" type="range" min="0" max="2" step="0.05" value="0.6"></label>
  <button class="btn" id="addObs">Add obstacle</button>
  <button class="btn" id="clearObs">Clear</button>
  <span class="kpi">FPS: <span id="fps">0</span></span>
</div>
<canvas id="stage" width="900" height="520" class="stage"></canvas>
<p><small class="mono">Tip: move the mouse to attract the flock; add round obstacles and watch avoidance.</small></p>

</section>
<footer><div class='container'>Contact: <a href='mailto:ambrosetheshield6@gmail.com'>ambrosetheshield6@gmail.com</a></div></footer>
<script>document.getElementById('theme').onclick=()=>document.documentElement.classList.toggle('light');</script>

<script>
const cv=document.getElementById('stage'), ctx=cv.getContext('2d');
let N=+document.getElementById('n').value; let boids=[], obs=[]; let mouse={x:-1,y:-1};
cv.addEventListener('mousemove',e=>{const r=cv.getBoundingClientRect(); mouse.x=e.clientX-r.left; mouse.y=e.clientY-r.top;});
cv.addEventListener('mouseleave',()=>{mouse.x=-1; mouse.y=-1;});
document.getElementById('addObs').onclick=()=>{obs.push({x:Math.random()*cv.width,y:Math.random()*cv.height,r:20+Math.random()*40})};
document.getElementById('clearObs').onclick=()=>{obs=[]};
document.getElementById('n').oninput=e=>{N=+e.target.value; init()};
function init(){boids=[]; for(let i=0;i<N;i++){boids.push({x:Math.random()*cv.width,y:Math.random()*cv.height,vx:(Math.random()*2-1)*2,vy:(Math.random()*2-1)*2});}}
function step(){
  const sep=+document.getElementById('sep').value, ali=+document.getElementById('ali').value, coh=+document.getElementById('coh').value;
  for(const b of boids){
    let sx=0, sy=0, ax=0, ay=0, cx=0, cy=0, cnt=0;
    for(const o of boids){ if(o===b) continue; const dx=o.x-b.x, dy=o.y-b.y; const d=Math.hypot(dx,dy); if(d<60){ cnt++; sx-=dx/(d||1); sy-=dy/(d||1); ax+=o.vx; ay+=o.vy; cx+=o.x; cy+=o.y; } }
    if(cnt){ ax/=cnt; ay/=cnt; const m=Math.hypot(ax,ay)||1; ax/=m; ay/=m; cx=cx/cnt - b.x; cy=cy/cnt - b.y; }
    for(const o of obs){ const dx=b.x-o.x, dy=b.y-o.y; const d=Math.hypot(dx,dy); if(d<o.r+20){ sx += dx/(d||1)*3; sy += dy/(d||1)*3; } }
    if(mouse.x>=0){ const dx=mouse.x-b.x, dy=mouse.y-b.y; const d=Math.hypot(dx,dy); cx += dx/(d||1)*0.2; cy += dy/(d||1)*0.2; }
    b.vx += sep*sx*0.04 + ali*ax*0.05 + coh*cx*0.002;
    b.vy += sep*sy*0.04 + ali*ay*0.05 + coh*cy*0.002;
    const sp=Math.hypot(b.vx,b.vy); const max=3.0; if(sp>max){ b.vx=b.vx/sp*max; b.vy=b.vy/sp*max; }
    b.x=(b.x+b.vx+cv.width)%cv.width; b.y=(b.y+b.vy+cv.height)%cv.height;
  }
}
let last=performance.now(), frames=0;
function draw(){ ctx.fillStyle='rgba(12,20,43,0.3)'; ctx.fillRect(0,0,cv.width,cv.height); ctx.strokeStyle='#6aa8ff'; ctx.lineWidth=1.5;
  for(const b of boids){ const ang=Math.atan2(b.vy,b.vx); ctx.save(); ctx.translate(b.x,b.y); ctx.rotate(ang); ctx.beginPath(); ctx.moveTo(8,0); ctx.lineTo(-8,-4); ctx.lineTo(-8,4); ctx.closePath(); ctx.stroke(); ctx.restore(); }
  ctx.strokeStyle='#1a2b55'; obs.forEach(o=>{ctx.beginPath(); ctx.arc(o.x,o.y,o.r,0,6.283); ctx.stroke();});
  frames++; const now=performance.now(); if(now-last>1000){ document.getElementById('fps').textContent=frames; frames=0; last=now; }
}
function loop(){ step(); draw(); requestAnimationFrame(loop); } init(); loop();
</script>

</body></html>